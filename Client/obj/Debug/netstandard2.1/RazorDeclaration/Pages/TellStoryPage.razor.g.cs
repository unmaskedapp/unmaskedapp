#pragma checksum "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\Pages\TellStoryPage.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "2c256ddf014848c9929dbf318a018728a2db47b3"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace UnmaskedApp.Client.Pages
{
    #line hidden
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using UnmaskedApp.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using UnmaskedApp.Client.Elements;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using UnmaskedApp.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\_Imports.razor"
using UnmaskedApp.Shared.Model;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\Pages\TellStoryPage.razor"
using System;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/tellstory")]
    public partial class TellStoryPage : Microsoft.AspNetCore.Components.ComponentBase, IDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 47 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\Pages\TellStoryPage.razor"
       
    bool requiresScrollToBottom = false;
    string savedString;
    List<StoryElement> items = new List<StoryElement>();

    protected override void OnInitialized()
    {
        DialogService.OnClose += Close;
    }

    void IDisposable.Dispose()
    {
        DialogService.OnClose -= Close;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (requiresScrollToBottom)
        {
            await JSRuntime.InvokeAsync<bool>("scrollToElementId", "bottom");
            requiresScrollToBottom = false;
        }
    }

    void AddItemTypeToList(StoryElement.Types type)
    {
        requiresScrollToBottom = true;
        items.Add(new StoryElement(type));
    }

    string GetItemPositionText(StoryElement item)
    {
        int position = items.IndexOf(item) + 1;
        return position.ToString() + ".";
    }

    async Task MoveItemIndexBy(StoryElement item, int amount)
    {
        await Task.Delay(0);

        int idx = items.IndexOf(item);
        items.RemoveAt(idx);

        int finalIndex = Math.Clamp(idx - amount, 0, items.Count);
        items.Insert(finalIndex, item);
    }

    async Task DeleteItem(StoryElement item)
    {
        await Task.Delay(0);

        items.Remove(item);
    }

    string SerializeStory()
    {
        System.Text.StringBuilder builder = new System.Text.StringBuilder();

        for (int i = 0; i < items.Count; i++)
        {
            string serializedObject = StoryElement.Serialize(items[i]);
            if (i < items.Count - 1)
                builder.AppendLine(serializedObject);
            else
                builder.Append(serializedObject);
        }

        string output = builder.ToString();

        return Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(output));
    }

    void DeserializeTest(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
        {
            NotificationService.Notify(new NotificationMessage() { Severity = NotificationSeverity.Error, Summary = "Error", Detail = "Loading story failed", Duration = 4000 });
            return;
        }

        string data = System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(value));

        items.Clear();
        string[] dataArray = data.Split("\n");
        items.AddRange(dataArray.Select(o => StoryElement.TryDeserialize(o)));
    }

    async Task SaveStory()
    {
        savedString = SerializeStory();
        if (string.IsNullOrWhiteSpace(savedString))
        {
            NotificationService.Notify(new NotificationMessage() { Severity = NotificationSeverity.Error, Summary = "Error", Detail = "Saving story failed", Duration = 4000 });
            return;
        }

        await DialogService.OpenAsync("Save Story", ds =>
            

#line default
#line hidden
#nullable disable
        (__builder2) => {
            __builder2.OpenElement(0, "RadzenCard");
            __builder2.AddAttribute(1, "Style", "padding: 20px; align-items:center;");
            __builder2.AddMarkupContent(2, "\r\n                ");
            __builder2.AddMarkupContent(3, "<p Style=\"margin-bottom: 10px;\">Click and copy the code</p>\r\n                ");
            __builder2.OpenElement(4, "div");
            __builder2.AddAttribute(5, "class", "row");
            __builder2.AddMarkupContent(6, "\r\n                    ");
            __builder2.OpenElement(7, "div");
            __builder2.AddAttribute(8, "class", "col-md-12");
            __builder2.AddMarkupContent(9, "\r\n                        ");
            __builder2.OpenElement(10, "RadzenTextBox");
            __builder2.AddAttribute(11, "ReadOnly", "true");
            __builder2.AddAttribute(12, "Value", 
#nullable restore
#line 148 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\Pages\TellStoryPage.razor"
                                                              savedString

#line default
#line hidden
#nullable disable
            );
            __builder2.CloseElement();
            __builder2.AddMarkupContent(13, "\r\n                        <div style=\"height:10px\"></div>\r\n                        <RadzenButton Text=\"Ok\" Click=\"() => ds.Close(true)\" Style=\"margin-bottom: 10px; width: 150px\"></RadzenButton>\r\n                    ");
            __builder2.CloseElement();
            __builder2.AddMarkupContent(14, "\r\n                ");
            __builder2.CloseElement();
            __builder2.AddMarkupContent(15, "\r\n            ");
            __builder2.CloseElement();
        }
#nullable restore
#line 153 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\Pages\TellStoryPage.razor"
                         );
    }


    string ValueDialog;
    async Task LoadStory() =>
        await DialogService.OpenAsync("Load Story", ds =>
        

#line default
#line hidden
#nullable disable
        (__builder2) => {
            __builder2.OpenElement(16, "RadzenCard");
            __builder2.AddAttribute(17, "Style", "padding: 20px; align-items:center;");
            __builder2.AddMarkupContent(18, "\r\n            ");
            __builder2.AddMarkupContent(19, "<p Style=\"margin-bottom: 10px;\">Confirm?</p>\r\n            ");
            __builder2.OpenElement(20, "div");
            __builder2.AddAttribute(21, "class", "row");
            __builder2.AddMarkupContent(22, "\r\n                ");
            __builder2.OpenElement(23, "div");
            __builder2.AddAttribute(24, "class", "col-md-12");
            __builder2.AddMarkupContent(25, "\r\n                    ");
            __builder2.OpenElement(26, "RadzenTextBox");
            __builder2.AddAttribute(27, "Placeholder", "Paste story code...");
            __builder2.AddAttribute(28, "@bind-Value", 
#nullable restore
#line 164 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\Pages\TellStoryPage.razor"
                                                                                  ValueDialog

#line default
#line hidden
#nullable disable
            );
            __builder2.CloseElement();
            __builder2.AddMarkupContent(29, @"
                    <div style=""height:10px""></div>
                    <RadzenButton Text=""Ok"" Click=""() => ds.Close(true)"" Style=""margin-bottom: 10px; width: 150px""></RadzenButton>
                    <RadzenButton Text=""Cancel"" Click=""() => ds.Close(false)"" ButtonStyle=""ButtonStyle.Secondary"" Style=""margin-bottom: 10px; width: 150px""></RadzenButton>
                ");
            __builder2.CloseElement();
            __builder2.AddMarkupContent(30, "\r\n            ");
            __builder2.CloseElement();
            __builder2.AddMarkupContent(31, "\r\n        ");
            __builder2.CloseElement();
        }
#nullable restore
#line 170 "D:\Developer\Projects\Web\UnmaskedApp\UnmaskedApp\Client\Pages\TellStoryPage.razor"
                     , new DialogOptions() { Height = "200" });


    void Close(dynamic result)
    {
        if (result == true)
        {
            try
            {
                DeserializeTest(ValueDialog);
            }
            catch
            {
                NotificationService.Notify(new NotificationMessage() { Severity = NotificationSeverity.Error, Summary = "Error", Detail = "Invalid story code", Duration = 4000 });
            }

            StateHasChanged();
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NotificationService NotificationService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private DialogService DialogService { get; set; }
    }
}
#pragma warning restore 1591
